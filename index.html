<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<title>yin xue</title>
<script src="./jquery.min.js"></script>

<script>
$(function(){

  // ---- Load manifest --------------------------------------------------------
  $.getJSON("manifest.json", function(manifest){
      console.log("Loaded manifest:", manifest);
      buildHome(manifest);
  }).fail(function(){
      $("body").append("<p style='color:red'>manifest.json not found</p>");
  });

  // ---- Build page -----------------------------------------------------------
  function buildHome(data){
      $("body").append("<div class='grid'></div>");

      // --- Header/menu once --------------------------------------------------
      $(".grid").append(`
        <div class='header'>
          <span id='name'><a href='./'>yin xue</a></span>
          <span id='menu'>
            <a href='#' id='show-all'>all</a>&nbsp;&nbsp;
            <a href='#' id='show-projects'>projects</a>&nbsp;&nbsp;
            <a href='#' id='show-commissions'>commissions</a>&nbsp;&nbsp;
            <a href='#' id='show-about'>about</a>
          </span>
        </div>
      `);

      // --- Build sections ----------------------------------------------------
      for (const section in data){
          const folders = data[section];
          for (const folder in folders){
              const files = folders[folder];
              const img = files.find(f => /\.(png|jpe?g|gif)$/i.test(f));
              const txt = files.find(f => /\.txt$/i.test(f));

              const folderPath = folder === "." ? `${section}/` : `${section}/${folder}/`;

              if(section === "about"){
                  // text-only page
                  $(".grid").append(`
                    <div class='grid-item about-item'>
                      <div class='about-text' data-file='${folderPath + txt}'>Loadingâ€¦</div>
                    </div>
                  `);
              } else if(img){
                  $(".grid").append(`
                    <div class='grid-item ${section}-item'>
                      <a href='${folderPath}'>
                        <img src='${folderPath + img}' alt='${folder}' />
                      </a>
                      ${txt ? `<p class='desc' data-file='${folderPath + txt}'>${folder}</p>` : ""}
                    </div>
                  `);
              }
          }
      }

      // --- Load .txt contents asynchronously --------------------------------
      $("[data-file]").each(function(){
          const el = $(this);
          const file = el.data("file");
          if(file.endsWith(".txt")){
              $.get(file, function(t){ el.text(t); });
          }
      });

      // --- Menu toggles ------------------------------------------------------
      $("#show-all").on("click", ()=>$(".grid-item").fadeIn(300));
      $("#show-projects").on("click", ()=>{$(".grid-item").hide(); $(".projects-item").fadeIn(300);});
      $("#show-commissions").on("click", ()=>{$(".grid-item").hide(); $(".commissions-item").fadeIn(300);});
      $("#show-about").on("click", ()=>{$(".grid-item").hide(); $(".about-item").fadeIn(300);});

      // --- Footer ------------------------------------------------------------
      $(".grid").append(`
        <div class='footer'>
          <div class='row'>
            <div class='column'>
              <h1>links</h1>
              <a href='https://www.youtube.com/user/danosdotnl' target='_blank'>instagram</a><br>
              <a href='https://github.com/dennisdebel' target='_blank'>rednote</a><br>
              <a href='https://soundcloud.com/errorpage' target='_blank'>soundcloud</a>
            </div>
            <div class='column'>
              <h1>contact</h1>
              dennis de bel<br>+31624106201<br>dennisdebel@gmail.com
            </div>
            <div class='column'>
              <h1>legal</h1>
              IBAN/SEPA: NL28ABNA06123<br>
              BIC: ABNAN<br>
              TAX: NL182813B01<br>
              Chamber of Commerce: 2448402
            </div>
            <div class='column'></div>
          </div>
        </div>
      `);
  }

});
</script>

<style>
@font-face {
  font-family:'yolo';
  src:url('./NimbusSanL-Reg.woff2') format('woff2'),
      url('./NimbusSanL-Reg.ttf') format('truetype');
}
body{font-family:"yolo";margin:0;padding:0}
a{color:black;text-decoration:none}
pre,address{display:none}

.grid{padding:8%;display:flex;flex-wrap:wrap}
.grid-item{flex:1;padding-left:20px;margin-bottom:2vw;transition:opacity .3s}
img{width:38vw;object-fit:cover}

.header{padding-left:20px;padding-bottom:10%;margin-top:-100px;width:96.5%}
#menu a{cursor:pointer}
#menu a:hover{text-decoration:underline}
span#name{float:left;font-size:1.3rem}
span#menu{float:right;font-size:1.3rem}

.footer{padding-top:50px;padding-left:20px;width:96.5%;padding-bottom:3rem}
.column{float:left;width:25%}
.row:after{content:"";display:table;clear:both}

.about-text{max-width:600px;line-height:1.5em;font-size:14px;padding:1em}

@media (max-width:800px){
  .grid{flex-direction:column;flex-wrap:nowrap;padding:1%}
  .grid-item{padding-left:0}
  img{width:100%}
  .column{width:100%}
  .header,.footer{width:100%;padding-left:0}
}
</style>
</head>
<body></body>
</html>
